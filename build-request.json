{
  "kind": "build_request",
  "title": "Fix approvals data mapping, file corruption in upload workflow, and add Documents filter bar",
  "projectName": "FinProLedge",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Audit the approvals data mapping in the frontend: inspect all fields returned by the backend `listApprovals` (or equivalent) query and ensure every field on each approval object — including nested detail fields such as client profile info, status, timestamps, and any sub-objects — is correctly destructured and rendered in the approvals tab of the Admin Dashboard. Remove any truncation logic that silently hides records or fields. Ensure the UI displays a complete, untruncated list of all approval entries with all their detail fields visible.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "The approvals list is currently truncated or missing detail fields. Please audit the data mapping to ensure all client approval details are rendered.",
          "Fix data synchronization issues; ensure all client approval objects and nested details are visible in the UI."
        ]
      },
      "acceptanceCriteria": [
        "All approval records returned by the backend are rendered in the approvals list without truncation.",
        "Every field of each approval object (including nested objects such as client profile details, status, timestamps) is displayed in the UI.",
        "No approval entry or sub-field is silently omitted due to missing or incorrect data mapping.",
        "The approvals list re-fetches and stays in sync after any status update or mutation."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Fix the file upload pipeline for Deliverables and To-Dos so that files attached by the client arrive at the admin side in their original, readable format. Audit the `ExternalBlob` conversion in `ClientDeliverableForm.tsx`, `CreateToDoForm.tsx`, and `ClientCreateToDoForm.tsx`: verify that the file is read as an `ArrayBuffer` or `Uint8Array` and stored as the correct Blob type without encoding corruption. On the admin download side, audit the reconstruction logic in `DocumentTable.tsx`, `ComplianceAdminToDoList.tsx`, and any download utility so that the original MIME type and byte sequence are preserved. Ensure the downloaded file opens correctly in its original application.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "We have an issue with the Deliverables, To-Dos upload workflow. While the client is successfully attaching the file and the admin is receiving it, the file becomes corrupted or unreadable upon arrival. The admin cannot open the document in its original format."
        ]
      },
      "acceptanceCriteria": [
        "A file uploaded by a client through the Deliverable or To-Do form is received by the admin with identical byte content to the original.",
        "The admin can open and read the downloaded file in its native application (e.g., PDF viewer, Word, Excel).",
        "MIME type metadata is preserved end-to-end so the browser/OS associates the file with the correct application.",
        "No Base64 double-encoding, truncation, or byte-level corruption occurs during upload or download."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add a persistent filter bar at the top of the Documents view (in `DocumentTable.tsx` and the Documents tab of the Admin Dashboard and Client Portal). The filter bar must allow querying/filtering by: document type (e.g., dropdown or multi-select of available types), upload date range (from/to date pickers), and document name (free-text search). Additionally provide a sort control to sort the document list by upload date (ascending/descending) or document name (A–Z / Z–A). Filters should apply reactively as values change without requiring a separate submit action.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Integrate a filter bar in the Documents view to sort/query by specific attributes."
        ]
      },
      "acceptanceCriteria": [
        "A filter bar is visible above the documents table in both the Admin Documents tab and the Client Portal Documents tab.",
        "Filtering by document type narrows the list to only matching entries.",
        "Filtering by upload date range shows only documents uploaded within the specified window.",
        "Free-text search on document name filters results in real time.",
        "Sort controls allow ascending/descending sort by date and alphabetical sort by name.",
        "Clearing all filters restores the full document list.",
        "Filter and sort state is applied client-side without requiring additional backend calls."
      ]
    }
  ],
  "constraints": [
    "Do not modify files listed in frontend.immutablePaths.",
    "All Motoko logic must remain within the single actor in backend/main.mo.",
    "File byte integrity must be preserved — do not alter the ExternalBlob storage schema in a way that requires a breaking migration unless strictly necessary."
  ],
  "nonGoals": [
    "Redesigning the overall UI layout or visual theme.",
    "Adding new document types or approval workflow steps not already present.",
    "Real-time/WebSocket-based live updates for approvals or documents.",
    "Filtering or search in tabs other than the Documents view."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}